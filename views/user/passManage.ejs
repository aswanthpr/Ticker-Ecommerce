<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TICKER</title>



    <link rel="icon" type="image/png" href="/image/download.png" />

    <link rel="stylesheet" type="text/css" href="/profile/util.css">
    <!-- <link rel="stylesheet" type="text/css" href="/profile/main.css"> -->

    <link rel="stylesheet" type="text/css" href="/profile/userProfile.css">
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css'>


	<!-- this is password icon  -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body>

	<div class="mt-5">
        <section class="breadcrumb-option mt-5">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="breadcrumb__text">
                            <h5>Address</h5>
                            <div class="breadcrumb__links">
                                <a href="/" class="text-dark text-decoration-none">Home</a>
                                <span>></span>
                               
								<a href="/user/profile" class="text-dark text-decoration-none">profile</a>
								<span>></span>
                                <span>Change Password</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>



	<div class="container">
		<div class="main-body">
			<div class="bg0 p-t-40 p-b-85">

				<div class="row">
					<div class="col-lg-4">
						<div class="card">
							<div class="card-body">
								<div class="d-flex flex-column align-items-center text-center">
									<img src="/userOrders/img/icon/icons8-male-user-30.png" alt="img"
										class="rounded-circle p-1 bg-dark" width="110">
									<div class="mt-3">
										<h4>
											
										</h4>
										<!-- <p class="text-secondary mb-1"></p>
									<p class="text-muted font-size-sm"></p>
									<button class="btn btn-primary">Follow</button>
									<button class="btn btn-outline-primary">Message</button> -->
									</div>
								</div>
								<hr class="my-4">
								<ul class="list-group list-group-flush align-items-center">
                                    <li class="list-group-item " style="width: 310px;">
                                        <a href="/user/profile"> <button type="button" class="btn btn-outline-dark "
                                                style="width: 280px;">User Profile</button> </a>
                                    </li>
                                    <li class="list-group-item " style="width: 310px;">
                                        <a href="/user/address"> <button type="button" class="btn btn-outline-dark "
                                                style="width: 280px;">Address Management</button> </a>
                                    </li>
                                    <li class="list-group-item " style="width: 310px;">
                                        <a href="/user/changePass"> <button type="button" class="btn btn-outline-dark active"
                                                style="width: 280px;">Change Password</button> </a>
                                    </li>
                                   
                                    <li class="list-group-item " style="width: 310px;">
                                        <a href="/user/order"> <button type="button" class="btn btn-outline-dark"
                                                style="width: 280px;">Order</button> </a>
                                    </li>
                                    
                                    <li class="list-group-item " style="width: 310px;">
                                        <a href="/user/wishlist"> <button type="button" class="btn btn-outline-dark"
                                                style="width: 280px;">Wallet</button> </a>
                                    </li>
                                     <!--<li class="list-group-item " style="width: 310px;">
                                        <a href="/user/referrel"> <button type="button" class="btn btn-outline-dark"
                                                style="width: 280px;">Referrel Code</button> </a>
                                    </li> -->
                                    <li class="list-group-item "
                                    style="width: 310px;">
                                    <a href="/logout"> <button type="button" class="btn btn-outline-dark"
                                            style="width: 280px;">Logout</button> </a>
                                </li>



                                </ul>
							</div>
						</div>
					</div>

					<div class="col-lg-8">
						<div class="card">
							<form action="/changePassword" class="form" method="post">
								<div class="card-body">
									<div class="row mb-3">
										<div class="col-sm-3">
											<h6 class="mb-0">Current Password</h6>
										</div>
										<div class="col-sm-9 text-secondary">
											<input type="password" name="password" id="password" class="form-control"
												type="text" placeholder="Enter password" required
												aria-required="true">

											<button class="btn toggle-password"
												style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);"><i
													class="fa fa-eye-slash" aria-hidden="true"></i>
											</button>
											<p style="color: red;" id="passErr"></p>

										</div>
									</div>
									<div class="row mb-3">
										<div class="col-sm-3">
											<h6 class="mb-0">New Password</h6>
										</div>
										<div class="col-sm-9 text-secondary">
											<input type="password" name="password1" id="password1" class="form-control"
												type="text" placeholder="Enter New Password" required=""
												aria-required="true">

											<button class="btn toggle-password"
												style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">
												<i class="fa fa-eye-slash" aria-hidden="true"></i>
											</button>
											<p style="color: red;" id="pass1Err"></p>

										</div>
									</div>
									<div class="row mb-3">
										<div class="col-sm-3">
											<h6 class="mb-0">Conform Password</h6>
										</div>
										<div class="col-sm-9 text-secondary">
											<input type="password" name="password2" id="password2" class="form-control"
												type="text" placeholder="Enter Conofrm Password" required
												aria-required="true">

											<button class="btn toggle-password"
												style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">
												<i class="fa fa-eye-slash" aria-hidden="true"></i>
											</button>
											<p style="color: red;" id="pass2Err"></p>

										</div>
									</div>

									<p></p>
									<div class="row">
										<div class="col-sm-3"></div>
										<div class="col-sm-9 text-secondary">
											<button type="button" class="btn btn-dark" onclick="updatePassword()">
												Save
												Changes </button>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="/profile/jquery.min.js"></script>
    <!-- Include Bootstrap JS -->
<!-- <script src="/profile/bootstrap.bundle.min.js"></script> -->

    <script src='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js'></script>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
	

	<script>

		// axios and sweet alert
		async function updatePassword() {


			const form = document.querySelector('form');
			const password = document.getElementById('password').value.trim();
			const passErr = document.getElementById('passErr');
			const password1 = document.getElementById('password1').value.trim();
			const pass1Err = document.getElementById('pass1Err');
			const password2 = document.getElementById('password2').value.trim();
			const pass2Err = document.getElementById('pass2Err');

			const passErrMsg = [];
			const pass1ErrMsg = [];
			const pass2ErrMsg = [];

			// Validation for current password
			if (password === '') {
				passErrMsg.push('Please enter your current password.');
			}

			// Validation for new password
			if (password1 === '') {
				pass1ErrMsg.push('Please enter your new password.');
			} else {
				//const passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,}$/;
				const passwordRegex =/^(?=.*[A-Za-z]).{6,}$/
				if (!passwordRegex.test(password1)) {
					pass1ErrMsg.push('Password must contain at least 6 characters, including at least one  letter.');

				}

			}

			// Validation for confirm password
			if (password2 === '') {
				pass2ErrMsg.push('Please enter your confirm password.');
			} else if (password1 !== password2) {
				pass2ErrMsg.push('Confirm password does not match new password.');
			}

			// Display error messages
			passErr.innerHTML = passErrMsg.join('<br>');
			pass1Err.innerHTML = pass1ErrMsg.join('<br>');
			pass2Err.innerHTML = pass2ErrMsg.join('<br>');

			if (passErrMsg.length > 0 || pass1ErrMsg.length > 0 || pass2ErrMsg.length > 0) {
				return;
			}

			const confirmation = await Swal.fire({
				title: 'Are you sure?',
				text: 'You won\'t be able to revert this!',
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, Change Password !'
			});
			if (confirmation.isConfirmed) {


				try {
			const password = document.getElementById('password').value.trim();
			const password1 = document.getElementById('password1').value.trim();
			const password2 = document.getElementById('password2').value.trim();
			
			const response = await fetch('/user/changePass',{
				method:'PATCH',
				headers:{
					'Content-Type':'application/json'

				},
				body:JSON.stringify({password,password1,password2})
			})
			const data = await response.json();
			
			if(data.success){
				await Swal.fire({
					icon:'success',
					title:'Success',
					text:data.message		
		     	}).then(()=>{
					window.location.href = '/user/changePass'
				})
			}else{
				await Swal.fire({
					icon:'Error',
					title:'Error',
					text:data.message,

				}).then(()=>{
					window.location.href='/user/changePass';

				})
			}
		} catch (error) {
		console.log(error+" error while change password")
		Swal.fire({
			icon:'error',
			title:'Error',
			text:'Internal server error'
		})
		}
			}

		}

		// Remove the form submission from here, as it will be handled by the updatePassword function

		// eye icon
		document.addEventListener('DOMContentLoaded', function () {
			const togglePasswordButtons = document.querySelectorAll('.toggle-password');

			togglePasswordButtons.forEach(button => {
				button.addEventListener('click', function (e) {
					e.preventDefault();
					const passwordInput = this.previousElementSibling; // Assuming the button is right after the input field
					const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
					passwordInput.setAttribute('type', type);
					this.innerHTML = type === 'password' ? '<i class="fa fa-eye-slash" aria-hidden="true"></i>' : '<i class="fa fa-eye" aria-hidden="true"></i>';
				});
			});
		});

	</script>
	<script>
		
	</script>



</body>

</html>