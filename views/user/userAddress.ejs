<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TICKER</title>



	<link rel="icon" type="image/png" href="/image/download.png" />

	<link rel="stylesheet" type="text/css" href="/profile/util.css">
	<!-- <link rel="stylesheet" type="text/css" href="/profile/main.css"> -->

	<link rel="stylesheet" type="text/css" href="/profile/userProfile.css">
	<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css'>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


</head>

<body>

	<div class="mt-5">
		<section class="breadcrumb-option">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="breadcrumb__text">
							<h5>Address management</h5>
							<div class="breadcrumb__links">
								<a href="/" class="text-dark text-decoration-none">Home</a>
								<span>></span>

								<a href="/user/profile" class="text-dark text-decoration-none">profile</a>
								<span>></span>
								<span>Address</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>



	<div class="container">
		<div class="main-body">
			<div class="bg0 p-t-40 p-b-85">

				<div class="row">
					<div class="col-lg-4">
						<div class="card">
							<div class="card-body">
								<div class="d-flex flex-column align-items-center text-center">
									<img src="/userOrders/img/icon/icons8-male-user-30.png" alt="Admin"
										class="rounded-circle p-1 bg-dark" width="110">
									<div class="mt-3">
										<!-- <h4>
										 <%= userData?.name %> 
										</h4> -->
										<!-- <p class="text-secondary mb-1"></p>
									<p class="text-muted font-size-sm"></p>
									<button class="btn btn-primary">Follow</button>
									<button class="btn btn-outline-primary">Message</button> -->
									</div>
								</div>
								<hr class="my-4">
								<ul class="list-group list-group-flush align-items-center">
									<li class="list-group-item " style="width: 310px;">
										<a href="/user/profile"> <button type="button" class="btn btn-outline-dark"
												style="width: 280px;">User Profile</button> </a>
									</li>
									<li class="list-group-item " style="width: 310px;">
										<a href="/user/address"> <button type="button"
												class="btn btn-outline-dark active" style="width: 280px;">Address
												Management</button> </a>
									</li>
									<li class="list-group-item " style="width: 310px;">
										<a href="/user/changePass"> <button type="button" class="btn btn-outline-dark"
												style="width: 280px;">Change Password</button> </a>
									</li>

									<li class="list-group-item " style="width: 310px;">
										<a href="/user/order"> <button type="button" class="btn btn-outline-dark"
												style="width: 280px;">Order</button> </a>
									</li>

									<li class="list-group-item " style="width: 310px;">
										<a href="/user/wallet"> <button type="button" class="btn btn-outline-dark"
												style="width: 280px;">Wallet</button> </a>
									</li>
									<!--<li class="list-group-item " style="width: 310px;">
                                        <a href="/user/referrel"> <button type="button" class="btn btn-outline-dark"
                                                style="width: 280px;">Referrel Code</button> </a>
                                    </li> -->
									<li class="list-group-item " style="width: 310px;">
										<a href="/logout"> <button type="button" class="btn btn-outline-dark"
												style="width: 280px;">Logout</button> </a>
									</li>



								</ul>
							</div>
						</div>
					</div>

					<div class="card mb-2   ml-4  col-md-6 col-sm-12 col-lg-6">
						<div class="card-header text-dark fw-bolder">Address Details</div>
						<div class="card-body">

							<div class="container">
								<div class="card">
									<div class="card-header">
										<a href="/user/addAddress">
											<button class="btn btn-success w-100">
												Add Address
											</button>
										</a>
									</div>
									<% if (addressData.addresses && addressData.addresses.length> 0) { %>

										<% for(let i=0 ; i<addressData.addresses.length ; i++){ %>

											<div class="card-body">
												<h5 class="card-title">
													<%= addressData.addresses[i].name %>
												</h5>
												<p class="card-text">
												<p>
													<span style="margin-right: 15px; font-weight: bold;">
														<%= addressData.addresses[i].phone %>
													</span>

												</p>
												<%= addressData.addresses[i].house %>,
													<%= addressData.addresses[i].locality %>,
														<%= addressData.addresses[i].city %>,
															<p>
																<%= addressData.addresses[i].state %> -
																	<%= addressData.addresses[i].pincode %>
															</p>

															</p>
															<% console.log(addressData.addresses[i]._id) %>
																<button type="button" class="btn btn-info"
																	onclick="editAddress('<%= addressData.addresses[i]._id %>')">
																	Edit </button>
																<button type="button" class="btn btn-danger"
																	onclick="deleteAddress('<%= addressData.addresses[i]._id %>')">
																	Delete </button>
											</div>


											<% } %>
												<% } else { %>
													<p style="text-align: center; margin-top: 20px;"> No address
														available. </p>
													<% } %>


								</div>
							</div>
						</div>
					</div>

				</div>

			</div>
		</div>
	</div>

	<script src="/profile/jquery.min.js"></script>
	<!-- Include Bootstrap JS -->
	<!-- <script src="/profile/bootstrap.bundle.min.js"></script> -->

	<script src='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js'></script>


	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>





	<script>
		async function editAddress(addressId) {
			console.log(addressId)
			window.location.href = `/user/editAddress?id=${addressId}`;
		}

		async function deleteAddress(id) {
			const confirmation = await Swal.fire({
				title: 'Are you sure?',
				text: 'You won\'t be able to revert this!',
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, delete it!',
				toast:true
			});

			if (confirmation.isConfirmed) {
				try {

					const response = await fetch('/user/deleteAddress', {
						method: "DELETE",
						headers: {
							'Content-Type': 'application/json'

						},
						body: JSON.stringify({ id })
					})
					const data = await response.json();

					if (data.success) {
						await Swal.fire({
							icon: 'success',
							title: 'Deleted!',
							text: data.message,
							toast: true,
							timer: 1000,
							showConfirmButton: false,
							position: 'top-end'
						}).then(() => {
							window.location.href = '/user/address';
						});
					} else {
						await Swal.fire({
							icon: 'error',
							title: 'Error',
							text: data.message,
							toast: true,
							timer: 1000,
							showConfirmButton: false,
							position: 'top-end'
						});
						window.location.href = '/user/address';
					}
				} catch (error) {
					console.error("Error deleting address: ", error.message);
					Swal.fire({
						icon: 'error',
						title: 'Error',
						text: 'Error when deleting Address',
						toast: true,
						timer: 1000,
						showConfirmButton: false,
						position: 'top-end'
					});
				}
			}
		}

	</script>


</body>

</html>