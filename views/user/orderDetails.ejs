<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title></title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Your CSS -->
    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <!-- Custom styles -->
    <link rel="stylesheet" href="../../admin/css/style.css">
    <link rel="stylesheet" href="/user/css/table.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<body>
    <!-- Top bar -->

    <body>
        <div class="mt-5">
            <section class="breadcrumb-option mt-5">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="breadcrumb__text">
                                <h5>Address</h5>
                                <div class="breadcrumb__links"> 
                                    <a href="/" class="text-dark text-decoration-none">Home</a>
                                    <span>></span>
                                   
                                    <a href="/user/profile" class="text-dark text-decoration-none">profile</a>
                                    <span>></span>
                                   
                                    <a href="/user/order" class="text-dark text-decoration-none">Order</a>
                                    <span>></span>
                                    <span> View Order Details</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    

        <div class=" fluid-container mt-4 ml-5">
            <div class="main-body">
                <div class="bg0 p-t-40 p-b-85">

                    <div class="row">
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-body ">
                                    <div class="d-flex flex-column align-items-center text-align-center">
                                        <img src="/userOrders/img/icon/icons8-male-user-30.png" alt="Admin"
                                            class="rounded-circle p-1 bg-dark" width="110">
                                        <div class="mt-3">
                                            
                                        </div>
                                    </div>
                                    <hr class="my-4">
                                    <ul class="list-group list-group-flush align-items-center ">
                                        <li class="list-group-item " style="width: 310px;">
                                            <a href="/user/profile"> <button type="button" class="btn btn-outline-dark"
                                                    style="width: 280px;">User Profile</button> </a>
                                        </li>
                                        <li class="list-group-item " style="width: 310px;">
                                            <a href="/user/address"> <button type="button" class="btn btn-outline-dark "
                                                    style="width: 280px;">Address Management</button> </a>
                                        </li>
                                        <li class="list-group-item " style="width: 310px;">
                                            <a href="/user/changePass"> <button type="button"
                                                    class="btn btn-outline-dark" style="width: 280px;">Change
                                                    Password</button> </a>
                                        </li>

                                        <li class="list-group-item " style="width: 310px;">
                                            <a href="/user/order"> <button type="button"
                                                    class="btn btn-outline-dark active"
                                                    style="width: 280px;">Order</button> </a>
                                        </li>

                                        
                                    <li class="list-group-item " style="width: 310px;">
                                        <a href="/user/wallet"> <button type="button"
                                                class="btn btn-outline-dark "
                                                style="width: 280px;">Wallet</button> </a>
                                    </li>
                                    <!-- <li class="list-group-item " style="width: 310px;">
                                        <a href="/user/referrel"> <button type="button" class="btn btn-outline-dark"
                                                style="width: 280px;">Referrel Code</button> </a>
                                    </li> -->
                                        <li class="list-group-item " style="width: 310px;">
                                            <a href="/logout"> <button type="button" class="btn btn-outline-dark"
                                                    style="width: 280px;">Logout</button> </a>
                                        </li>

                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- PAGES INNER -->
                        <!-- <section class="pages-in chart-page col-lg-8">





                            <div class="col">
                                <div class="card shadow">
                                    <div class="table-responsive"> -->

                                       

<section class="pages-in chart-page col-lg-8">
    <div class="col">
        <div class="card shadow">
            <div class="table-responsive">
              
                <section class="py-4">
                    <% if(orderData !== null){ %>
                        <div class="container">
                            <h3 class="d-none">Account</h3>
                            <div class="row">
                              
                                           
                                            <% orderData.forEach(element => { %>
                                                <% 
                                                let hasDeliveredProduct = false;
                                                element.orderedItems.forEach(item => { 
                                                    if (item.orderStatus == "Delivered") {
                                                        hasDeliveredProduct = true;
                                                    }
                                                }); 
                                                %>
                                                <% if (hasDeliveredProduct) { %>
                                                    <div class="col-md-12 col-lg-12 d-flex flex-column">
                                                        <div class="card flex-grow-1 mt-3 mt-md-0">
                                                            <div class="card-body">
                                                                <div class="d-flex justify-content-center">
                                                                    
                                                                    <a class="btn btn-success btn-sm text-white" href="/user/order/orderDetails/invoice?orderId=<%= element._id %>">VIEW INVOICE</i></a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <% } %>
                                            <% }); %>
                                            
                                        
                                <!-- Order Details and Address -->
                                <div class="col-md-6 d-flex flex-column">
                                    <div class="card flex-grow-1">
                                        <div class="card-body">
                                            <% orderData.forEach(orderData => { %>
                                             
                                            
                                            <!-- Order Details -->
                                            <!-- <% var deliveryDate = new Date(orderData.currentDate); %>
                                            <% var today = new Date(); %>
                                            <% deliveryDate.setDate(deliveryDate.getDate() + 7); %> -->
                                            <div class="order-details">
                                                <h4>Order Details</h4> 
                                                <p class="fw-bolder text-secondary">Order ID: <span class="fw-bolder text-dark"><%= orderData.orderId %></span></p>
                                                <p class="fw-bolder text-secondary">Ordered Date: <span class="fw-bolder text-dark"><%= new Date(orderData.createdAt).toLocaleDateString() %></span></p>
                                                <p class="fw-bolder text-secondary"> Expected Delivary: <span class="fw-bolder text-dark"><%= new Date(orderData.expectedDelivary).toLocaleDateString() %></span></p>
                                                <p class="fw-bolder text-secondary">Total Price: <span class="fw-bolder text-dark" >₹<%= orderData.totalPrice %></span></p>
                                                <% if (orderData.couponOffer &&orderData.couponClaim) { %>
                                                    <p class="fw-bolder text-secondary">Coupon Claim: <span class="fw-bolder text-success" >₹<%= orderData.couponClaim %>+</span></p>
                                                    <p class="fw-bolder text-secondary">Coupon Offer: <span class="fw-bolder text-dark" ><%= orderData.couponOffer %>%</span></p>
                                                <% } %>
                                                <p class="fw-bolder text-secondary">Payment Method: <span class="fw-bolder badge badge-warning"><%= orderData.paymentMethod %></span></p>
                                                
                                            </div>
                                            <!-- Status text -->
                                            <p class="status-text fw-bolder text-secondary">Payment status: <span class="fw-bolder badge badge-info text-dark"><%= orderData.paymentStatus %></span></p>
                                            
                                            <% }) %>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 d-flex flex-column">
                                    <div class="card flex-grow-1 mt-3 mt-md-0">
                                        <div class="card-body">
                                            <!-- Address -->
                                            <div class="address">
                                                <h4>Address</h4>
                                                <% orderData.forEach(element => { %>
                                                    <p class="fw-bolder text-secondary">Name: <span class="fw-bolder text-dark"><%= element.address.name %></span></p>
                                                    <p class="fw-bolder text-secondary">Mobile:<span class="fw-bolder text-dark"><%= element.address.phone %></span></p>
                                                    
                                                    <p class="fw-bolder text-secondary">Locality:<span class="fw-bolder text-dark"><%= element.address.locality %></span></p>
                                                    <p class="fw-bolder text-secondary">House:<span class="fw-bolder text-dark"><%= element.address.house %></span></p>
                                                    <p class="fw-bolder text-secondary">City:<span class="fw-bolder text-dark"><%= element.address.city %></span></p>
                                                    <p class="fw-bolder text-secondary">Landmark:<span class="fw-bolder text-dark"><%= element.address.landmark %></span></p>
                                                    <p class="fw-bolder text-secondary">State:<span  class="fw-bolder text-dark"><%= element.address.state %></span></p>
                                                    <p class="fw-bolder text-secondary">Pincode: <span class="fw-bolder text-dark"><%= element.address.pincode %></span></p>
                                                <% }) %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Product Details -->
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <% orderData.forEach(data => { %>
                                                     
                                                    
                                                <% data.orderedItems.forEach(item => { %>
                                            <!-- Product Details -->
                                            <div class="product-details">
                                                <div class="row">
                                                   
                                                 
                                                        <hr>
                                                        <!-- Left side for the image -->
                                                        <div class="col-md-4">
                                                            <img  src="/uploads/<%= item.image[0] %>" alt="Product Image" class="img-fluid w-75 h-100" style="height: 17em;">
                                                        </div>
                                                        <!-- Right side for other details -->
                                                        <div class="col-md-8">
                                                            <h6 class="fw-bolder">Product Details</h6>
                                                            <div class="product">
                                                                <p class="fw-bolder text-secondary">Product Name: <span class="fw-bolder text-dark"><%= item?.productName %></span></p>
                                                                <p class="fw-bolder text-secondary">Quantity: <span class="fw-bolder text-dark"><%= item?.cartQuantity %></span></p>
                                                                <p class="fw-bolder text-secondary">Price: <span class="fw-bolder text-dark"><del class="text-secondary">₹<%=item.mrp%></del> <span>₹<%= item.offerPrice %></span><strong class="text-success ml-3"><%=item?.offer%>%</strong></p>
                                                                <p  class="fw-bolder text-secondary"> Order Status:<span class="fw-bolder text-dark badge
                                                                    <% if (item?.orderStatus == "Cancelled"||item?.orderStatus =="Returned") { %>
                                                                     badge-danger
                                                                    <% }else if(item?.orderStatus =="Delivered"){%>
                                                                    badge-success
                                                                    <%}else if(item?.orderStatus =="Pending"){%>
                                                                    badge-info
                                                                    <%}else if(item?.orderStatus =="Shipped"){%>
                                                                    badge-warning
                                                                    <%}%>
                                                                   
                                                                     
                                                                    "><%= item?.orderStatus %></span></p>
                                                                <% if (item?.Reason!==null) { %>
                                                                    <p  class="fw-bolder text-secondary">Reason:<span class="fw-bolder text-dark"><%= item?.Reason %></span></p>
                                                                <% } %>
                                                              
                                                            </div>
                                                        </div>
                                                    
                                                </div>
                                                
                                            </div>
                                            <hr class="bg-dark">
                                            <% }) %>
                                            
                                                    <% }) %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% } else { %>
                        <% console.log('No orders found') %>
                        <p>NO ORDERS FOUND</p>
                        <script>
                            window.location.href = '/login';
                        </script>
                    <% } %>
                </section>
            </div>
        </div>
    </div>
</section>


                                    <!-- </div>
                                </div>
                            </div>


                        </section> -->

                    </div>
                </div>
            </div>
        </div>










        <!-- Bootstrap and Custom JavaScript libraries -->
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="../../admin/vendors/js/vendor.bundle.base.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    </body>

</html>