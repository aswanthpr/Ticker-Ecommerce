<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Order Details</title>

    <!-- Use only Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/util.css">
    <link rel="stylesheet" href="/user/css/main.css">
    <link rel="stylesheet" href="../../admin/css/style.css">
    <link rel="stylesheet" href="/user/css/table.css">
</head>

<body>
    <div class="container mt-5">
        <section class="breadcrumb-option">
            <div class="row">
                <div class="col-12">
                    <div class="breadcrumb__text">
                        <h5>Address</h5>
                        <div class="breadcrumb__links">
                            <a href="/" class="text-dark text-decoration-none">Home</a> &gt;
                            <a href="/user/profile" class="text-dark text-decoration-none">Profile</a> &gt;
                            <a href="/user/order" class="text-dark text-decoration-none">Order</a> &gt;
                            <span>View Order Details</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="row mt-4">
            <!-- Sidebar -->
            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-body text-center">
                        <svg version="1.1" width="50" height="50" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0"
                            y="0" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32" xml:space="preserve">
                            <style>
                                .st1 {
                                    fill: #333
                                }
                            </style>
                            <path class="st1"
                                d="M25.838 31H6.162a3.957 3.957 0 0 1-3.245-1.661 3.956 3.956 0 0 1-.549-3.604l.704-2.113a6.034 6.034 0 0 1 4.966-4.059C10.131 19.307 13.211 19 16 19c2.788 0 5.869.307 7.963.563a6.032 6.032 0 0 1 4.965 4.059l.704 2.113a3.954 3.954 0 0 1-.55 3.604A3.955 3.955 0 0 1 25.838 31zM16 21c-2.688 0-5.681.298-7.718.549a4.02 4.02 0 0 0-3.312 2.706l-.704 2.112c-.206.618-.106 1.274.274 1.802S5.511 29 6.162 29h19.676a1.98 1.98 0 0 0 1.622-.83c.381-.528.48-1.185.275-1.803l-.704-2.112a4.02 4.02 0 0 0-3.312-2.706C21.681 21.298 18.687 21 16 21zM16 18c-4.687 0-8.5-3.813-8.5-8.5S11.313 1 16 1c4.687 0 8.5 3.813 8.5 8.5S20.687 18 16 18zm0-15c-3.584 0-6.5 2.916-6.5 6.5S12.416 16 16 16s6.5-2.916 6.5-6.5S19.584 3 16 3z" />
                            <path
                                d="M12.04 10.54c-.543 0-.988-.435-1-.98a4.964 4.964 0 0 1 1.394-3.564 4.968 4.968 0 0 1 3.505-1.535c.562.01 1.009.428 1.02.98a1 1 0 0 1-.98 1.02 2.982 2.982 0 0 0-2.103.92 2.981 2.981 0 0 0-.836 2.139 1 1 0 0 1-.98 1.02h-.02z"
                                style="fill:#ffb77d" />
                        </svg>
                        <hr class="my-4">
                        <ul class="list-group">
                            <li class="list-group-item"><a href="/user/profile" class="btn btn-outline-dark w-100">User
                                    Profile</a></li>
                            <li class="list-group-item"><a href="/user/address"
                                    class="btn btn-outline-dark w-100">Address Management</a></li>
                            <li class="list-group-item"><a href="/user/changePass"
                                    class="btn btn-outline-dark w-100">Change Password</a></li>
                            <li class="list-group-item"><a href="/user/order"
                                    class="btn btn-outline-dark active w-100">Order</a></li>
                            <li class="list-group-item"><a href="/user/wallet"
                                    class="btn btn-outline-dark w-100">Wallet</a></li>
                            <li class="list-group-item"><a href="/logout" class="btn btn-outline-dark w-100">Logout</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-8">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <section>
                            <% if(orderData !==null){ %>
                                <% orderData.forEach(element=> { %>
                                    <% let hasDeliveredProduct=element.orderedItems.some(item=> item.orderStatus ===
                                        "Delivered"); %>
                                        <% if (hasDeliveredProduct) { %>
                                            <div class="text-center mb-3">
                                                <a class="btn btn-success btn-sm"
                                                    href="/user/order/orderDetails/invoice?orderId=<%= element._id %>">VIEW
                                                    INVOICE</a>
                                            </div>
                                            <% } %>
                                                <% }); %>

                                                    <div class="row">
                                                        <!-- Order Details -->
                                                        <div class="col-md-6">
                                                            <div class="card mb-3">
                                                                <div class="card-body">
                                                                    <% orderData.forEach(orderData=> { %>
                                                                        <h5>Order Details</h5>
                                                                        <p><strong>Order ID:</strong>
                                                                            <%= orderData.orderId %>
                                                                        </p>
                                                                        <p><strong>Ordered Date:</strong>
                                                                            <%= new
                                                                                Date(orderData.createdAt).toLocaleDateString()
                                                                                %>
                                                                        </p>
                                                                        <p><strong>Expected Delivery:</strong>
                                                                            <%= new
                                                                                Date(orderData.expectedDelivary).toLocaleDateString()
                                                                                %>
                                                                        </p>
                                                                        <p><strong>Total Price:</strong> ₹<%=
                                                                                orderData.totalPrice %>
                                                                        </p>
                                                                        <% if (orderData.couponOffer &&
                                                                            orderData.couponClaim) { %>
                                                                            <p><strong>Coupon Claim:</strong> ₹<%=
                                                                                    orderData.couponClaim %>+</p>
                                                                            <p><strong>Coupon Offer:</strong>
                                                                                <%= orderData.couponOffer %>%
                                                                            </p>
                                                                            <% } %>
                                                                                <p><strong>Payment Method:</strong>
                                                                                    <span
                                                                                        class="badge bg-warning text-dark">
                                                                                        <%= orderData.paymentMethod %>
                                                                                    </span>
                                                                                </p>
                                                                                <p><strong>Payment Status:</strong>
                                                                                    <span
                                                                                        class="badge bg-info text-dark">
                                                                                        <%= orderData.paymentStatus %>
                                                                                    </span>
                                                                                </p>
                                                                                <% }); %>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <!-- Address Details -->
                                                        <div class="col-md-6">
                                                            <div class="card mb-3">
                                                                <div class="card-body">
                                                                    <h5>Address</h5>
                                                                    <% orderData.forEach(element=> { %>
                                                                        <p><strong>Name:</strong>
                                                                            <%= element.address.name %>
                                                                        </p>
                                                                        <p><strong>Mobile:</strong>
                                                                            <%= element.address.phone %>
                                                                        </p>
                                                                        <p><strong>Locality:</strong>
                                                                            <%= element.address.locality %>
                                                                        </p>
                                                                        <p><strong>House:</strong>
                                                                            <%= element.address.house %>
                                                                        </p>
                                                                        <p><strong>City:</strong>
                                                                            <%= element.address.city %>
                                                                        </p>
                                                                        <p><strong>Landmark:</strong>
                                                                            <%= element.address.landmark %>
                                                                        </p>
                                                                        <p><strong>State:</strong>
                                                                            <%= element.address.state %>
                                                                        </p>
                                                                        <p><strong>Pincode:</strong>
                                                                            <%= element.address.pincode %>
                                                                        </p>
                                                                        <% }) %>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Product Details -->
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <% orderData.forEach(data=> { %>
                                                                <% data.orderedItems.forEach(item=> { %>
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-4">
                                                                            <img src="<%= item.image[0] %>"
                                                                                alt="Product Image"
                                                                                class="img-fluid rounded">
                                                                        </div>
                                                                        <div class="col-md-8">
                                                                            <h6>Product Name: <%= item?.productName %>
                                                                            </h6>
                                                                            <p>Quantity: <%= item?.cartQuantity %>
                                                                            </p>
                                                                            <p>Price: <del>₹<%= item.mrp %></del> ₹<%=
                                                                                    item.offerPrice %> <strong
                                                                                        class="text-success ms-2">
                                                                                        <%= item?.offer %>%
                                                                                    </strong></p>
                                                                            <p>Order Status: <span class="badge
                        <% if (item?.orderStatus === 'Cancelled' || item?.orderStatus === 'Returned') { %> bg-danger <% }
                        else if (item?.orderStatus === 'Delivered') { %> bg-success <% }
                        else if (item?.orderStatus === 'Pending') { %> bg-info <% }
                        else if (item?.orderStatus === 'Shipped') { %> bg-warning <% } %>
                      ">
                                                                                    <%= item?.orderStatus %>
                                                                                </span></p>
                                                                            <% if (item?.Reason) { %>
                                                                                <p>Reason: <%= item?.Reason %>
                                                                                </p>
                                                                                <% } %>
                                                                        </div>
                                                                    </div>
                                                                    <hr>
                                                                    <% }) %>
                                                                        <% }) %>
                                                        </div>
                                                    </div>
                                                    <% } else { %>
                                                        <p>NO ORDERS FOUND</p>
                                                        <script>window.location.href = '/login';</script>
                                                        <% } %>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>